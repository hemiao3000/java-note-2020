<span class="title">消息确认模式</span>

在默认情况下，生产者把消息发送出去<small>（发给 Rabbit MQ）</small>之后，Rabbit MQ 是不会返回任何信息给生产者的，也就是说，生产者也不知道消息有没有正确到达 Rabbit MQ<small>（更无从知道有没有到达消费者）</small>。

为此，Rabbit MQ 中有两种解决方式：

- AMQP 规范中的事务机制

  AMQP 规范定义了事务的概念<small>（Rabbit MQ 实现了 AMQP 规范，自然也就支持事务机制）</small>。当 <strong>把信道设置成事务模式</strong> 后，生产者和 RabbitMQ 之间会有一种发送/响应机制判断当前命令操作是否可继续。不过，由于事务模式需要生产者同步等待 RabbitMQ 的执行结果，因此在性能上会极大降低消息服务器的吞吐量。一般情况下，不会使用它。

- 消息确认（ACK）模式

  消息确认模式是 RabbitMQ 对 AMQP 的扩展实现，在 *`2.3.1`* 及更高版本中可用。<strong>把信道设置成确认模式</strong> 之后，在该信道上发布的所有消息都会被分配一个唯一 ID，一旦消息被投递到所匹配的队列中，该信道就会像生产者发送确认信息，在确认信息中包含了之前的唯一 ID，从而让生产者知道消息已到达目的队列。

  消息确认模式最大优势是 <strong>异步</strong>，生产者发送完一条消息后可继续发送下一条消息，当生产者收到确认消息后调用回调方法处理。这种方式比 事务机制 要【轻】，对 RabbitMQ 的性能的影响要小。

# 常见的确认消费模式介绍

RabbitMQ 的消息【确认消费】模式有 3 种，它们定义在 **`AcknowledgeMode`** 枚举类种，分别是：NONE、AUTO 和 MANUAL。

| 模式 | 说明 |
| :- | :- |
| NONE | 【无须确认】机制。Producer 将消息发送至 Broker，Consumer 监听/接收到该消息时，无须发送反馈消息给 Broker。|
| AUTO | 【自动确认】机制。Producer 将消息发送给 Broker，Consumer 监听/接收到该消息时，需要发送一个 AUTO ACK 的反馈信息给 Broker，而 Broker 在接收到确认消息后，才将消息从队列种移除。其中，反馈消息的回复是自动进行的，Consumer 干预。 |
| MANUAL | 【手动确认】机制。和 AUTO 类似，只不过返回消息的回复是需要 Consumer 手动以代码的形式发送。|

由于 None 的消费模式实在发送完消息之后不再理会，因此这种模式在实际业务场景中比较少见。

## 自动消费模式



## 手动消费模式


