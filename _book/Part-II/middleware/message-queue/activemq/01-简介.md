<span class="title">ActiveMQ</span>

ActiveMQ 是由 Apache 出品的一款开源消息中间件，旨在为应用程序提供高效、可扩展、稳定、安全的企业级消息通信。

因为 ActiveMQ 是完整实现了 <strong>JMS 1.1</strong>，所以从 Java 使用者的角度来看，其基本概念与 JMS 1.1 规范是一致的。 

# 连接器

ActiveMQ Broker 的主要作用是为客户端应用提供一种通信机制，为此 ActiveMQ 提供了一种连接支持，并用 <font color="#0088dd">**连接器**<small>（Connector）</small></font>来描述它。

为了交换信息，消息 **生产者** 和 **消费者**<small>（统称为客户端）</small>都需要连接到消息代理服务器，这种客户端和消息代理服务器之间的通信就是通过传输连接器完成的。

很多情况下，用户连接消息代理服务器的需求侧重点不同，有的更关注性能，有的更侧重安全性，因此，ActiveMQ 提供了一系列<small>（不同）</small>的连接协议来选择，来覆盖这些使用场景

- VM

  允许客户端和消息服务器直接在 VM 内部通信，采用的不是 Socket 连接，而是直接的虚拟机本地方法调用，从而避免网络传输开销。

  应用场景仅限于服务器和客户端在同一个 JVM 中。

  <small>这种情况也就是所谓的 **内嵌式 ActiveMQ**，并没有启动外部的 ActiveMQ 服务器。本质上还是方法同步调用，但是代码的形式『长得』和发消息一样。</small>

- TCP

  客户端通过 TCP 连接到远程的消息服务器。
  
  <small>毫无疑问，这种情况下，你需要单独启动 ActiveMQ 消息服务器。</small>

ActiveMQ 还支持一些高级的协议，比如：

- failover

  failover 是一种重新连接的机制，工作于上面介绍连接协议的上层，用于建立可靠的传输。
  
  其配置语法允许指定任意多个复合的 URI，它会自动选择其中的一个 URI 来尝试建立连接，如果该连接没有成功，则会继续选择其它的 URI 进行尝试。

  其配置语法：*`failover:(tcp://localhost:61616,tcp://192.168.x.xxx:61616)`*

# 消息存储

持久化消息是 JMS 2.0 规范中新增的特性，对于 JMS 2.0 所要求的持久化消息，ActiveMQ 存储它的方式有三种：

- 存储到内存

  将所有要持久化的消息都放到内存中。注意，需要设置消息服务器的 JVM 和内存大小。

- 存储到文件

    - AMQ：5.3 以前版本的默认存储方式。

    - KahaDB：从 5.3 版本开始的默认使用的存储方式。比 AMQ 存储方式具有更好的可靠性和可恢复性。

    - LevelDB：5.6 版本推出的新的存储方式。其持久化性能要好于 KahaDB。<small>在可预见的未来的某个版本中将会替代 KahaDB 成为默认的使用方式。</small>

- 存储到数据库

    - JDBC：基于 JDBC 的方式将消息存储与数据库。<small>（虽然可以结合使用缓存写入技术，但是）很显然，这种方式存储性能最低</small>。


