<span class="title">映射结果集（高级）</span>

Table 的列名与 PO 类的属性名的不同，只是一个小 case。`<resultMap>` 真正的作用和价值并非在此，而是在于 <font color="#0088dd">**关系映射**</font> 。

# 一对一映射

使用自定义映射的第二个，也是更重要的原因是：***关联映射*** 。

两张表的一对一映射在类与类的关系上体现为 <font color="#0088dd">一个类“持有”另一个类</font>。双向的一对一映射则表现为 <font color="#0088dd">两个类互相“持有”</font>。

持有方所对应的表为『从表』，被持有方所丢应的表为『主表』。`association` 元素用于 <font color="#0088dd">从表</font> 方。

`association` 元素的常用属性有：

| 属性 | 说明 |
| :- | :- |
| property 属性|表示所映射对象的属性名。|
| column 属性|表示表的列名，此处必为 ***外键列*** 。|
| javaType 属性|表示属性所对应的类型名称。|
| select 属性|表示为了获取关联对象，所调用的另一条 MyBatis select 语句的 id 。|

**第一种写法：传统写法**

```xml
<mapper namespace="demo.dao.EmployeeMapper">

  <resultMap id="BaseResultMap" type="demo.bean.po.Employee">
    <id ... />
    <result ... />
    ...

    <association property="department" javaType="demo.bean.po.Department">
      <id column="deptno" property="deptno" jdbcType="INTEGER"/>
      <result column="dname" property="dname" jdbcType="VARCHAR"/>
      <result column="loc" property="loc" jdbcType="VARCHAR"/>
    </association>

  <select id="..." resultType="BaseResultMap">

</mapper>
```


**第二种写法：调用法**

```xml
<mapper namespace="demo.dao.EmployeeMapper">

  <resultMap id="BaseResultMap" type="demo.bean.po.Employee">
    <id ... />
    <result ... />
    ...
    <association property="department" 
        column="deptno" 
        javaType="demo.bean.po.Department"
        select="demo.dao.DepartmentMapper.selectByPrimaryKey"/>
    </resultMap>

  <select id="..." resultType="BaseResultMap">

</mapper>
```

# 一对多映射

一对多的映射在类与类的关系上体现为：一个类持有另一个类的一个对象，另一个类持有这个类的对象集合。

如果一对多映射是单向的，则只会使用到 collection 元素；如果一对多映射是双向的，那么还会使用到前面所说的 association 元素。

collection 元素的常用属性有：

| 属性 | 说明 |
| :- | :- |
| property 属性 | 表示所映射对象的属性名。|
| column 属性 | 表示表的列名，此处必为 ***外键列*** |
| javaType 属性 | 表示属性所对应的类型名称，此处必为某种集合类型 |
| ofType 属性 | 表示集合当中的单元类型 |
| select 属性 | 表示为了获取关联对象，所调用的另一条 MyBatis select 语句的 id |

**第一种写法：**

```xml
<resultMap id="xxx" type="Department">
  <id column="deptno" property="deptno"/>
  <result column="dname" property="dname"/>
  <result column="loc" property="loc"/>

  <collection property="employeeList" ofType="Employee">
    <id column="empno" property="empno"/>
    <result column="ename" property="ename"/>
    <result column="job" property="job"/>
    <result column="mgr" property="mgr"/>
    <result column="hiredate" property="hiredate"/>
    <result column="sal" property="sal"/>
    <result column="comm" property="comm"/>
    <result column="deptno" property="deptno"/>
  </collection>
</resultMap>

  <select id="selectByPK" parameterType="int" resultMap="xxx">
    select dept.deptno  deptno,
      dept.dname   dname,
      dept.loc     loc,
      emp.empno    empno,
      emp.ename    ename,
      emp.job      job,
      emp.mgr      mgr,
      emp.hiredate hiredate,
      emp.sal      sal,
      emp.comm     com
    from dept,
      emp
    where dept.deptno = emp.deptno
      and dept.deptno = #{deptno}
  </select>
```

**第二种写法：**

```xml
<mapper namespace="demo.dao.DepartmentMapper">

  <resultMap id="BaseResultMap" type="demo.bean.po.Department">
    <id ... />
    <result ... />
    ...
    <collection column="deptno" 
        javaType="java.util.List"
        ofType="demo.bean.po.Employee" 
        property="employeeSet"
        select="demo.dao.EmployeeMapper.selectByPK"/>
  </resultMap>

  <select ...>
```

# 多对多映射

MyBatis 并没有提供专门的元素用于多对多方案，采取了一种“聪明”的办法，将“三张表”的多对多关系转化为“两张表”的一对多关系。

所以，在多对多关系中，使用的仍然是 `collection` 元素。

例如：

```xml
<mapper namespace="demo.dao.DepartmentMapper">
  <resultMap id="BaseResultMap" type="demo.bean.po.Department">
    <id ... />
    <result ... />
    ...
    <collection column="deptno" 
        javaType="java.util.Set"  
        ofType="demo.bean.po.Employee" 
        property="employeeSet"
        select="demo.dao.EmployeeMapper.selectByDeptno"/>
  </resultMap>

  <select ...>
```